{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * craft-attendees plugin for Craft CMS 3.x
 *
 * craft-attendees index.twig
 *
 * @author    Percipio.London
 * @copyright Copyright (c) 2021 Percipio.London
 * @link      https://percipio.london
 * @package   Craftattendees
 * @since     0.1.0
 */
#}

{% extends "craft-attendees/_layouts/_cp" %}
{% import "_includes/forms" as forms %}


{% do view.registerAssetBundle("percipiolondon\\craftattendees\\assetbundles\\trainingscpsection\\TrainingsCPSectionAsset") %}

{% set pluginCpUrl = url('craft-attendees') %}
{% set settings = craft.app.getPlugins().getPlugin('craft-attendees').getSettings() %}
{% set selectedSubnavItem = 'trainings' %}
{%- set fullPageForm = true -%}
{% set eventTypes = {
    'onlineEvent': 'Online Event',
    'locationEvent': 'Location Event',
    'hybridEvent': 'Hybrid Event'
} %}

{% set title = "Trainings | Attendees" %}

{% set crumbs = [
    { label: "Attendees", url: url(pluginCpUrl) },
    { label: "Trainings"|t('craft-attendees'), url: url(pluginCpUrl ~ '/trainings') },
] %}

{# Content that should appear in the page header#}
{% block actionButton %}
    <a href="{{ cpUrl() ~ '/' ~ settings.eventSection ~ '/' ~ event.slug }}" class="btn">{{ "Edit Event"|t('craft-attendees') }}</a>
    <input type="submit" data-action="craft-attendees/training/save" class="btn submit" value="{{ 'Save'|t('craft-attendees') }}">
{% endblock %}

{# The content of the CP Section#}
{% set content %}
    <input type="hidden" name="action" value="craft-attendees/training/save">

    <div class="training">
        <h1>{{ event.title }}</h1>
        <h6 class="event-meta">
            <span>{{ eventTypes[event.type.handle] ?? '' }}</span>
            <span>&nbsp;&nbsp;-&nbsp;&nbsp;</span>
            <span>{{ event.eventCategories.one().title ?? '' }}</span>
        </h6>
        <p>{{ event.description }}</p>

        <hr/>

        <div class="event-actions">
            <a href="#" class="btn">{{ "Import"|t('craft-attendees') }}</a>
        </div>

        {{ forms.editableTableField({
            id: 'attendee-data',
            class: '',
            name: 'attendee[data]',
            label: 'Attendees' |t,
            instructions: "Use <b>+</b> button below to add a row for each attendee, if multiple people from the same organisation participated, each should be added on a new line." |t,
            required: false,
            static: false,
            cols: {
                status: {
                    class: "thin action rsn-status",
                    heading: "" |t,
                    type: "singleline",
                    value: 0,
                },
                school: {
                    class: "action rsn-autocomplete orderable",
                    heading: "School / Organisation" |t,
                    type: "singleline",
                    placeholder: "click to activate",
                    width: '35%',
                },
                schooldata: {
                    class: "rsn-data",
                    type: "hidden",
                },
                postcode: {
                    class: "rsn-postcode orderable",
                    heading: "Post code" |t,
                    type: "text",
                    width: '10%',
                },
                name: {
                    class: "rsn-name orderable",
                    heading: "Name of attendee" |t,
                    type: "text",
                    width: '20%',
                },
                email: {
                    class: "rsn-email",
                    heading: "Email" |t,
                    type: "text",
                    width: '25%',
                },
                role: {
                    class: "rsn-role",
                    heading: "Role" |t,
                    type: "select",
                    options: {
                        "": "Select one",
                        "na": "Not Applicable",
                        "support": "Support Staff" |t,
                        "leader-middle": "Middle leader" |t,
                        "leader": "Leadership" |t,
                        "teacher": "Teacher" |t,
                    },
                },
                attendance: {
                    class: "rsn-attendance",
                    heading: "Days Attended" |t,
                    type: "select",
                    options: {
                        "1": "1",
                        "2": "2",
                        "3": "3",
                        "4": "4",
                        "5": "5",
                        "6": "6",
                        "7": "7",
                        "8": "8",
                        "9": "9",
                        "10": "10",
                    },
                },
                optin: {
                    class: "rsn-mailing",
                    heading: "Newsletter" |t,
                    type: "lightswitch",
                    width: "1%",
                },
            },
            addRowLabel: "Add another attendee" |t,
        }) }}
    </div>
{% endset %}
