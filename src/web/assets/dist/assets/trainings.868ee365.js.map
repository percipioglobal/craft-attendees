{"version":3,"file":"trainings.868ee365.js","sources":["../../../../../buildchain/src/store/trainings.ts"],"sourcesContent":["import { defineStore } from \"pinia\"\nimport axios from 'axios'\n\nconst ENDPOINT = window?.Attendee?.cpUrl ?? 'https://researchschool.org.uk/cp'\n\nexport const useTrainingsStore = defineStore('trainings', {\n    state:() => ({\n        attendees: null,\n        totalAttendees: null,\n        attendeeInput: null,\n        dataEngagement: null,\n        attendeeFormErrors: false,\n        attendeeSuccess: false,\n        showForm: false,\n        loading: false,\n        loadingApi: false,\n        schools: null,\n        followOnSupportOptions: null,\n        order: 'date'\n    }),\n    actions: {\n        fetchOptions(event) {\n            const self = this\n            this.loading = true\n\n            axios({\n                method: 'get',\n                url: `${ENDPOINT}/craft-attendees/trainings/fetch-support-options/${event}`,\n            })\n            .then(function (response) {\n                self.loading = false\n                self.followOnSupportOptions = response.data?.options\n                self.followOnSupportSelectedOptions = response.data?.selectedOptions\n            });\n        },\n        saveOption(data) {\n            const self = this\n            this.loading = true\n\n            axios({\n                method: 'post',\n                url: `${ENDPOINT}/actions/craft-attendees/training/save-support-options`,\n                data: data\n            })\n            .then(function (response) {\n                self.loading = false\n            });\n        },\n        async fetchSchools(query) {\n\n            if(query){\n                this.loadingApi = true\n\n                const api = axios.create({\n                    baseURL: `https://api.v2.metaseed.io/schools/?mode=legacy&query=${query}`,\n                    timeout: 3000\n                })\n\n                const response = await api.get('')\n\n                if(response?.data){\n                    this.schools = response.data?.suggestions;\n                    this.loadingApi = false\n                }else{\n                    this.loadingApi = false\n                }\n            }\n        },\n        deleteAttendees(attendees) {\n            const self = this\n            this.loading = true\n\n            axios({\n                method: 'post',\n                url: `${ENDPOINT}/actions/craft-attendees/training/delete`,\n                data: attendees\n            })\n            .then(function (response) {\n                self.loading = false\n\n                attendees.attendees.forEach((attendee) => {\n                    self.attendees = self.attendees.filter((at) => at.id != attendee)\n                })\n\n            });\n        },\n\n        submitAttendee(formValues) {\n\n            let formObj = {};\n\n            if(formValues instanceof FormData) {\n                for (var pair of formValues.entries()) {\n                    formObj[pair[0]] = pair[1]\n                }\n            } else {\n                formObj = formValues\n            }\n\n            this.attendeeFormErrors = false\n            this.loading = true\n            this.attendeeSuccess = false\n            this.attendeeInput = formObj\n            const self = this\n\n            axios({\n                method: 'post',\n                url: `${ENDPOINT}/actions/craft-attendees/training/save`,\n                data: formValues\n            })\n            .then(function (response) {\n                if(!response.data.success){\n                    self.attendeeFormErrors = response.data.errors\n                    self.loading = false\n                    self.attendeeSuccess = false\n                } else {\n                    let updatedAttendee = self.attendees.filter(a => a.id == response?.data?.attendee?.id)\n                    const attendeeIndex = self.attendees.findIndex(a => a.id == response?.data?.attendee?.id)\n\n                    if(updatedAttendee.length > 0){\n                        updatedAttendee = updatedAttendee[0]\n                        updatedAttendee.name = formObj?.name\n                        updatedAttendee.orgName = formObj?.orgName\n                        updatedAttendee.orgUrn = parseInt(formObj?.orgUrn)\n                        updatedAttendee.postCode = formObj?.postCode\n                        updatedAttendee.days = formObj?.days\n                        updatedAttendee.email = formObj?.email\n                        updatedAttendee.newsletter = formObj?.newsletter\n                        updatedAttendee.approved = formObj?.approved\n                        updatedAttendee.jobRole = formObj?.jobRole\n                        updatedAttendee.priority = formObj?.priority\n                        updatedAttendee.anonymous = formObj?.anonymous\n\n                        self.attendees[attendeeIndex] = updatedAttendee\n                    } else {\n                        self.attendees.unshift(response?.data?.attendee)\n                    }\n\n                    self.loading = false\n                    self.attendeeFormErrors = false\n                    self.attendeeSuccess = true\n                    self.attendeeInput = null\n                }\n            });\n\n        },\n        \n        fetchAttendees(event, order, limit, offset, init = false){\n            const self = this;\n            this.loading = true;\n            this.order = order;\n\n            if(init){\n                this.attendees = []\n            }\n\n            axios({\n                method: 'get',\n                url: `${ENDPOINT}/craft-attendees/trainings/attendees/${event}/${order}/${limit}/${offset}`,\n            })\n            .then(function (response) {\n                self.loading = false\n                self.totalAttendees = parseInt(response?.data?.meta?.total)\n                self.attendees = offset !== 0 ? self.attendees.concat(response?.data?.attendees) : response?.data?.attendees\n            });\n        },\n        fetchEngagementData(event) {\n\n            axios({\n                method: 'get',\n                url: `${ENDPOINT}/craft-attendees/trainings/engagement-data/${event}`,\n            })\n            .then(function (response) {\n                self.loading = false\n                self.dataEngagement = response?.data?.engagement\n            });\n\n        },\n        setShowFrom(value){\n            this.attendeeFormErrors = false\n            // this.attendeeSuccess = false\n            this.showForm = value\n        },\n        resetForm(){\n            this.loading = false\n            this.attendeeFormErrors = false\n            // this.attendeeSuccess = false\n            this.attendeeInput = null\n        },\n        clearSchools() {\n            this.schools = null\n        }\n    }\n})\n"],"names":[],"mappings":"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"}