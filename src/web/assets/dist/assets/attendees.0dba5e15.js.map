{"version":3,"file":"attendees.0dba5e15.js","sources":["../../../../../buildchain/src/store/trainings.ts","../../../../../buildchain/plugin-vue:export-helper","../../../../../buildchain/src/js/attendees.ts"],"sourcesContent":["import { defineStore } from \"pinia\"\nimport axios from 'axios'\n\nconst ENDPOINT = window?.Attendee?.cpUrl ?? 'https://researchschool.org.uk/cp'\n\nexport const useTrainingsStore = defineStore('trainings', {\n    state:() => ({\n        attendees: null,\n        totalAttendees: null,\n        attendeeInput: null,\n        attendeeFormErrors: false,\n        attendeeSuccess: false,\n        showForm: false,\n        loading: false,\n        loadingApi: false,\n        schools: null,\n        followOnSupportOptions: null\n    }),\n    actions: {\n        fetchOptions(event) {\n            const self = this\n            this.loading = true\n\n            axios({\n                method: 'get',\n                url: `${ENDPOINT}/craft-attendees/trainings/fetch-support-options/${event}`,\n            })\n            .then(function (response) {\n                self.loading = false\n                self.followOnSupportOptions = response.data?.options\n                self.followOnSupportSelectedOptions = response.data?.selectedOptions\n            });\n        },\n        saveOption(data) {\n            const self = this\n            this.loading = true\n\n            axios({\n                method: 'post',\n                url: `${ENDPOINT}/actions/craft-attendees/training/save-support-options`,\n                data: data\n            })\n            .then(function (response) {\n                self.loading = false\n            });\n        },\n        async fetchSchools(query) {\n\n            if(query){\n                this.loadingApi = true\n\n                const api = axios.create({\n                    baseURL: `https://api.v2.metaseed.io/schools/?mode=legacy&query=${query}`,\n                    timeout: 3000\n                })\n\n                const response = await api.get('')\n\n                if(response?.data){\n                    this.schools = response.data?.suggestions;\n                    this.loadingApi = false\n                }else{\n                    this.loadingApi = false\n                }\n            }\n        },\n        deleteAttendee(attendee) {\n            const self = this\n            this.loading = true\n\n            axios({\n                method: 'post',\n                url: `${ENDPOINT}/actions/craft-attendees/training/delete`,\n                data: attendee\n            })\n            .then(function (response) {\n                self.loading = false\n                self.attendees = self.attendees.filter((at) => at.id != attendee.attendeeId)\n            });\n        },\n        submitAttendee(formValues) {\n\n            let formObj = {};\n\n            if(formValues instanceof FormData) {\n                for (var pair of formValues.entries()) {\n                    formObj[pair[0]] = pair[1]\n                }\n            }else{\n                formObj = formValues\n            }\n\n            this.attendeeFormErrors = false\n            this.loading = true\n            this.attendeeSuccess = false\n            this.attendeeInput = formObj\n            const self = this\n\n            axios({\n                method: 'post',\n                url: `${ENDPOINT}/actions/craft-attendees/training/save`,\n                data: formValues\n            })\n            .then(function (response) {\n\n                if(!response.data.success){\n                    self.attendeeFormErrors = response.data.errors\n                    self.loading = false\n                    self.attendeeSuccess = false\n                }else{\n                    let updatedAttendee = self.attendees.filter(a => a.id == response?.data?.attendee?.id)\n                    const attendeeIndex = self.attendees.findIndex(a => a.id == response?.data?.attendee?.id)\n\n                    if(updatedAttendee.length > 0){\n                        updatedAttendee = updatedAttendee[0]\n                        updatedAttendee.name = formObj?.name\n                        updatedAttendee.orgName = formObj?.orgName\n                        updatedAttendee.orgUrn = formObj?.orgUrn\n                        updatedAttendee.postCode = formObj?.postCode\n                        updatedAttendee.days = formObj?.days\n                        updatedAttendee.email = formObj?.email\n                        updatedAttendee.newsletter = formObj?.newsletter\n                        updatedAttendee.approved = formObj?.approved\n                        updatedAttendee.jobRole = formObj?.jobRole\n\n                        self.attendees[attendeeIndex] = updatedAttendee\n                    }else{\n                        self.attendees.unshift(response?.data?.attendee)\n                    }\n\n                    self.loading = false\n                    self.attendeeFormErrors = false\n                    self.attendeeSuccess = true\n                    self.attendeeInput = null\n                }\n            });\n\n        },\n        fetchAttendees(event, limit, offset){\n            const self = this;\n            this.loading = true;\n\n            axios({\n                method: 'get',\n                url: `${ENDPOINT}/craft-attendees/trainings/attendees/${event}/${limit}/${offset}`,\n            })\n            .then(function (response) {\n                self.loading = false\n                self.totalAttendees = parseInt(response?.data?.meta?.total)\n                self.attendees = offset !== 0 ? self.attendees.concat(response?.data?.attendees) : response?.data?.attendees\n            });\n        },\n        setShowFrom(value){\n            this.attendeeFormErrors = false\n            // this.attendeeSuccess = false\n            this.showForm = value\n        },\n        resetForm(){\n            this.loading = false\n            this.attendeeFormErrors = false\n            // this.attendeeSuccess = false\n            this.attendeeInput = null\n        },\n        clearSchools() {\n            this.schools = null\n        }\n    }\n})\n","\nexport default (sfc, props) => {\n  const target = sfc.__vccOpts || sfc;\n  for (const [key, val] of props) {\n    target[key] = val;\n  }\n  return target;\n}\n","// Import our CSS\nimport '@/css/app.pcss';\nimport Attendees from '@/vue/attendees/Attendees.vue';\nimport { createApp } from 'vue';\nimport { createPinia } from 'pinia'\n\nconst main = async () => {\n    const app = createApp({...Attendees});\n    app.use(createPinia())\n\n    const vm = app.mount('#training');\n};\n\nmain().then( (root) => {\n});\n"],"names":["Attendees"],"mappings":"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"}