import{z as R,d as S,r as p,s as z,_ as P,c as h,f as k,v as $,a as o,g as F,h as y,n as T,b as x,i as B,F as O,j as K,o as w,t as A,l as j,p as H,k as D,m as W,D as G,E as J}from"./plugin-vue_export-helper.f99a0d42.js";import{a as Q}from"./index.a482147f.js";var E,I;const X=(I=(E=window.Attendee)==null?void 0:E.cpUrl)!=null?I:"https://researchschool.org.uk/cp",Z=R("export",{state:()=>({tags:null,loading:!1}),actions:{fetchTags(e){var u;const t=this;this.loading=!0;const l=new FormData;l.append("tag",e),l.append("CRAFT_CSRF_TOKEN",(u=window.Attendee)==null?void 0:u.csrf),l.append("action","actions/craft-attendees/tag/fetch-tags"),Q({method:"post",url:`${X}/actions/craft-attendees/tag/fetch-tags`,data:l}).then(function(f){var r,i;t.loading=!1,(r=f.data)!=null&&r.success&&(t.tags=(i=f.data)==null?void 0:i.tags)})},clearTags(){this.tags=null}}}),ee=S({setup(e,{emit:t}){const l=p(null),u=Z(),f=p(Math.floor(Math.random()*100)+Date.now()),{tags:r,loading:i}=z(u),c=p(""),s=p(null),d=p(!1),n=p(0),a=p(!0),v=p({}),g=b=>{var m,M;c.value=(M=(m=b.currentTarget)==null?void 0:m.dataset)==null?void 0:M.tag,d.value=!1,u.clearTags()},C=()=>{a.value=!0,c.value.length>2&&(d.value=!0,u.fetchTags(c.value))},V=b=>{var m;((m=c.value)==null?void 0:m.length)===0&&u.clearTags(),d.value=b},N=()=>{s.value&&clearTimeout(s.value),s.value=setTimeout(C,200)},Y=()=>{var b,m;n.value=n.value<((b=r.value)==null?void 0:b.length)-1?n.value+1:((m=r.value)==null?void 0:m.length)-1,l.value.querySelectorAll("li")[n.value].scrollIntoView({block:"nearest"})},U=()=>{n.value=n.value>0?n.value-1:0,l.value.querySelectorAll("li")[n.value].scrollIntoView({block:"nearest"})},q=()=>{var b;c.value=(b=r.value[n.value])==null?void 0:b.title,d.value=!1,u.clearTags()},_=()=>{c.value=null,L()},L=()=>{d.value=!1,u.clearTags()};return{tag:c,showDropdown:d,schoolDropdown:l,currentSelectionIndex:n,clearResults:a,loading:i,errors:v,uniqueId:f,tags:r,delay:N,handleTagSelect:g,handleTagInput:C,handleFocus:V,handleClear:_,onArrowDown:Y,onArrowUp:U,selectCurrentSelection:q}}}),te={class:"w-full relative"},oe=["aria-owns"],se=["aria-expanded","id"],ae=["data-tag"],ne={class:"block w-full text-sm font-medium"},le={key:1,class:"p-2 pt-3 inline-block"},re=o("svg",{class:"animate-spin mr-1 h-4 w-4 text-gray-800",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),ie=[re];function de(e,t,l,u,f,r){var i,c;return w(),h("div",te,[k(o("input",{name:"tag","onUpdate:modelValue":t[0]||(t[0]=s=>e.tag=s),onInput:t[1]||(t[1]=(...s)=>e.delay&&e.delay(...s)),onFocus:t[2]||(t[2]=s=>e.handleFocus(!0)),onBlur:t[3]||(t[3]=s=>e.handleFocus(!1)),onKeydown:[t[4]||(t[4]=F(y((...s)=>e.onArrowDown&&e.onArrowDown(...s),["prevent"]),["down"])),t[5]||(t[5]=F(y((...s)=>e.onArrowUp&&e.onArrowUp(...s),["prevent"]),["up"])),t[6]||(t[6]=F(y((...s)=>e.selectCurrentSelection&&e.selectCurrentSelection(...s),["prevent"]),["enter"]))],class:T(["block peer w-full px-2 py-2 text-sm text-gray-600 box-border bg-gray-100 rounded-lg pr-7",(i=e.errors)!=null&&i.tags?"border-solid border-red-300":"border-solid border-gray-100"]),placeholder:"Search for a tag (optional)","aria-owns":`metaseed-list-${e.uniqueId}`,"aria-autocomplete":"list",role:"combobox"},null,42,oe),[[$,e.tag]]),((c=e.tag)==null?void 0:c.length)>3?(w(),h("span",{key:0,onClick:t[7]||(t[7]=(...s)=>e.handleClear&&e.handleClear(...s)),class:"text-blue-800 bg-gray-100 block w-6 text-center flex items-center justify-center h-8 absolute right-0 top-1 cursor:pointer"},"\u2715")):x("",!0),k(o("ul",{class:"absolute right-0 top-full mt-1 w-128 max-h-52 overflow-scroll z-10 bg-gray-100 rounded-lg shadow-xl",ref:"schoolDropdown","aria-expanded":e.showDropdown,role:"listbox",id:`tag-list-${e.uniqueId}`},[e.loading?x("",!0):(w(!0),h(O,{key:0},K(e.tags,(s,d)=>(w(),h("li",{key:s==null?void 0:s.slug,role:"option"},[o("span",{onMousedown:t[8]||(t[8]=(...n)=>e.handleTagSelect&&e.handleTagSelect(...n)),onTouch:t[9]||(t[9]=(...n)=>e.handleTagSelect&&e.handleTagSelect(...n)),role:"button","data-tag":s==null?void 0:s.title,class:T(["p-2 pointer-all hover:bg-blue-600 hover:text-white focus:bg-blue-600 block group",e.currentSelectionIndex===d?"bg-blue-600 text-white":""])},[o("span",ne,A(s.title),1)],42,ae)]))),128)),e.loading?(w(),h("li",le,ie)):x("",!0)],8,se),[[B,e.showDropdown]])])}var ue=P(ee,[["render",de]]);const ce=S({components:{"input-tags":ue},props:{csrf:{type:String,required:!0},site:{type:String,required:!0}},setup(){const e=p("2017-07-04"),t=p(new Date().getFullYear()+"-"+("0"+(new Date().getMonth()+1)).slice(-2)+"-"+("0"+new Date().getDate()).slice(-2)),l=p(new Date().getFullYear()+"-"+("0"+(new Date().getMonth()+1)).slice(-2)+"-"+("0"+new Date().getDate()).slice(-2)),u=p(new Date().getFullYear()+"-"+("0"+(new Date().getMonth()+1)).slice(-2)+"-"+("0"+(new Date().getDate()-1)).slice(-2)),f=p(""),r=p({}),i=new Date;return i.setMonth(i.getMonth()-3),e.value=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2),{startDate:e,endDate:t,today:l,yesterday:u,tag:f,errors:r,validateForm:d=>{r.value={},t.value>l.value&&(r.value.endDate="This date can't be in the future"),e.value>u.value&&(r.value.startDate="This date can't be after yesterday"),Object.keys(r.value).length>0&&d.preventDefault()},setPredefined:d=>{const n=new Date,a=new Date,v=n.getFullYear();switch(d){case"6m":t.value=l.value,a.setMonth(a.getMonth()-6),e.value=a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2);break;case"12m":t.value=l.value,a.setMonth(a.getMonth()-12),e.value=a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2);break;case"cay":e.value=v-1+"-09-01",t.value=v+"-07-31";break;case"lay":e.value=v-2+"-09-01",t.value=v-1+"-07-31";break;default:t.value=l.value,a.setMonth(a.getMonth()-3),e.value=a.getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)}}}}}),pe=o("div",{class:"flex items-center mb-8"},[o("h2",null,"Export data from the trainings"),o("div",{class:"flex-grow text-right"},[o("button",{class:"bg-emerald-300 text-emerald-800 font-bold py-2 px-3 text-sm rounded-lg cursor-pointer inline-block mt-5"},"Export data")])],-1),ge=o("input",{type:"hidden",name:"action",value:"craft-attendees/csv/export"},null,-1),ve=["value"],be=["value"],fe={class:"grid grid-cols-3 gap-4"},me=H('<div><label><span class="text-xs font-bold text-gray-400 block mb-1">Select an export type</span><select name="exportType" class="block h-10 px-1 rounded-md bg-gray-100 w-full border-none mb-2"><option default value="attendee">Attendee Data</option><option default value="event">Event ID reference table</option><option default value="subscriptions">Mailing list subscribers</option><option default value="school-attendee">School data</option></select></label></div><div><label><span class="text-xs font-bold text-gray-400 block mb-1">Select an event type</span><select name="eventType" class="block h-10 px-1 rounded-md bg-gray-100 w-full border-none mb-2"><option default value="16,17,25">All events</option><option default value="17">Location Event</option><option default value="16">Online Event</option><option default value="25">Hybrid Event</option></select></label></div><div><label><span class="text-xs font-bold text-gray-400 block mb-1">Which schools?</span><select name="school" class="block h-10 px-1 rounded-md bg-gray-100 w-full border-none mb-2"><option default value="all">All schools</option><option default value="prior">Priority schools</option></select></label></div>',3),he={class:"col-span-2"},ye=o("span",{class:"text-xs font-bold text-gray-400 block mb-1"},"Time period",-1),we={class:"w-full grid grid-cols-2 gap-4"},xe={class:"flex"},De={class:"flex w-full"},ke=o("span",{class:"text-xs text-gray-400 inline-block"},"From",-1),Te=["max"],Fe={key:0,class:"text-xs p-2 inline-block font-bold text-red-300"},$e={class:"flex"},Ae={class:"flex w-full"},Se=o("span",{class:"text-xs text-gray-400 inline-block"},"To",-1),Ce=["max"],Me={key:0,class:"text-xs p-2 inline-block font-bold text-red-300"},Ee={class:"-mt-4 text-xs"},Ie=D("Predefined selections: "),Pe=D(", "),Ve=D(", "),Ne=D(", "),Ye=D(" or "),Ue=o("span",{class:"text-xs font-bold text-gray-400 block mb-1"},"Filter by tag",-1);function qe(e,t,l,u,f,r){var c,s,d,n,a,v;const i=W("input-tags");return w(),h("form",{ref:"form",method:"post",action:"","accept-charset":"UTF-8",onSubmit:t[7]||(t[7]=(...g)=>e.validateForm&&e.validateForm(...g)),novalidate:""},[pe,ge,o("input",{type:"hidden",name:"CRAFT_CSRF_TOKEN",value:e.csrf},null,8,ve),o("input",{type:"hidden",name:"site",value:e.site},null,8,be),o("div",fe,[me,o("div",he,[o("label",null,[ye,o("div",we,[o("div",xe,[o("div",De,[ke,k(o("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=g=>e.startDate=g),name:"start",max:e.yesterday,class:T(["px-2 flex-grow py-2 text-sm text-gray-600 appearance-none box-border bg-gray-100 rounded-lg border-solid",(c=e.errors)!=null&&c.startDate?"border-red-300":"border-gray-100"])},null,10,Te),[[$,e.startDate]])]),(s=e.errors)!=null&&s.startDate?(w(),h("span",Fe,A((d=e.errors)==null?void 0:d.startDate),1)):x("",!0)]),o("div",$e,[o("div",Ae,[Se,k(o("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=g=>e.endDate=g),name:"end",max:e.today,class:T(["flex-grow px-2 py-2 text-sm text-gray-600 appearance-none box-border bg-gray-100 rounded-lg border-solid",(n=e.errors)!=null&&n.endDate?"border-red-300":"border-gray-100"])},null,10,Ce),[[$,e.endDate]])]),(a=e.errors)!=null&&a.endDate?(w(),h("span",Me,A((v=e.errors)==null?void 0:v.endDate),1)):x("",!0)])]),o("p",Ee,[Ie,o("span",{class:"text-xs text-blue-600 cursor-pointer",onClick:t[2]||(t[2]=y(g=>e.setPredefined("3m"),["prevent"]))},"Last\xA03\xA0months"),Pe,o("span",{class:"text-xs text-blue-600 cursor-pointer",onClick:t[3]||(t[3]=y(g=>e.setPredefined("6m"),["prevent"]))},"Last\xA06\xA0months"),Ve,o("span",{class:"text-xs text-blue-600 cursor-pointer",onClick:t[4]||(t[4]=y(g=>e.setPredefined("12m"),["prevent"]))},"Last\xA0year"),Ne,o("span",{class:"text-xs text-blue-600 cursor-pointer",onClick:t[5]||(t[5]=y(g=>e.setPredefined("cay"),["prevent"]))},"Current\xA0academic\xA0year"),Ye,o("span",{class:"text-xs text-blue-600 cursor-pointer",onClick:t[6]||(t[6]=y(g=>e.setPredefined("lay"),["prevent"]))},"Last\xA0academic\xA0year")])])]),o("div",null,[o("label",null,[Ue,j(i)])])])],544)}var _e=P(ce,[["render",qe]]);const Le=S({components:{"form-export":_e}}),Re=async()=>{const e=G(Le);return e.use(J()),console.log("export?"),e.mount("#export")};Re().then(e=>{});
//# sourceMappingURL=export.488e6b5b.js.map
