import{z as p,A as h}from"./plugin-vue_export-helper.31108d73.js";var g,f;const u=(f=(g=window==null?void 0:window.Attendee)==null?void 0:g.cpUrl)!=null?f:"https://researchschool.org.uk/cp",A=p("trainings",{state:()=>({attendees:null,totalAttendees:null,attendeeInput:null,attendeeFormErrors:!1,attendeeSuccess:!1,showForm:!1,loading:!1,loadingApi:!1,schools:null,followOnSupportOptions:null,order:"date"}),actions:{fetchOptions(n){const t=this;this.loading=!0,h({method:"get",url:`${u}/craft-attendees/trainings/fetch-support-options/${n}`}).then(function(s){var a,i;t.loading=!1,t.followOnSupportOptions=(a=s.data)==null?void 0:a.options,t.followOnSupportSelectedOptions=(i=s.data)==null?void 0:i.selectedOptions})},saveOption(n){const t=this;this.loading=!0,h({method:"post",url:`${u}/actions/craft-attendees/training/save-support-options`,data:n}).then(function(s){t.loading=!1})},async fetchSchools(n){var t;if(n){this.loadingApi=!0;const a=await h.create({baseURL:`https://api.v2.metaseed.io/schools/?mode=legacy&query=${n}`,timeout:3e3}).get("");a!=null&&a.data?(this.schools=(t=a.data)==null?void 0:t.suggestions,this.loadingApi=!1):this.loadingApi=!1}},deleteAttendees(n){const t=this;this.loading=!0,h({method:"post",url:`${u}/actions/craft-attendees/training/delete`,data:n}).then(function(s){t.loading=!1,n.attendees.forEach(a=>{t.attendees=t.attendees.filter(i=>i.id!=a)})})},submitAttendee(n){let t={};if(n instanceof FormData)for(var s of n.entries())t[s[0]]=s[1];else t=n;this.attendeeFormErrors=!1,this.loading=!0,this.attendeeSuccess=!1,this.attendeeInput=t;const a=this;h({method:"post",url:`${u}/actions/craft-attendees/training/save`,data:n}).then(function(i){var o;if(!i.data.success)a.attendeeFormErrors=i.data.errors,a.loading=!1,a.attendeeSuccess=!1;else{let e=a.attendees.filter(c=>{var d,l;return c.id==((l=(d=i==null?void 0:i.data)==null?void 0:d.attendee)==null?void 0:l.id)});const r=a.attendees.findIndex(c=>{var d,l;return c.id==((l=(d=i==null?void 0:i.data)==null?void 0:d.attendee)==null?void 0:l.id)});e.length>0?(e=e[0],e.name=t==null?void 0:t.name,e.orgName=t==null?void 0:t.orgName,e.orgUrn=parseInt(t==null?void 0:t.orgUrn),e.postCode=t==null?void 0:t.postCode,e.days=t==null?void 0:t.days,e.email=t==null?void 0:t.email,e.newsletter=t==null?void 0:t.newsletter,e.approved=t==null?void 0:t.approved,e.jobRole=t==null?void 0:t.jobRole,e.priority=t==null?void 0:t.priority,e.anonymous=t==null?void 0:t.anonymous,a.attendees[r]=e):a.attendees.unshift((o=i==null?void 0:i.data)==null?void 0:o.attendee),a.loading=!1,a.attendeeFormErrors=!1,a.attendeeSuccess=!0,a.attendeeInput=null}})},fetchAttendees(n,t,s,a,i=!1){const o=this;this.loading=!0,this.order=t,i&&(this.attendees=[]),h({method:"get",url:`${u}/craft-attendees/trainings/attendees/${n}/${t}/${s}/${a}`}).then(function(e){var r,c,d,l;o.loading=!1,o.totalAttendees=parseInt((c=(r=e==null?void 0:e.data)==null?void 0:r.meta)==null?void 0:c.total),o.attendees=a!==0?o.attendees.concat((d=e==null?void 0:e.data)==null?void 0:d.attendees):(l=e==null?void 0:e.data)==null?void 0:l.attendees})},setShowFrom(n){this.attendeeFormErrors=!1,this.showForm=n},resetForm(){this.loading=!1,this.attendeeFormErrors=!1,this.attendeeInput=null},clearSchools(){this.schools=null}}});export{A as u};
//# sourceMappingURL=trainings.b60237e0.js.map
