import{z as p}from"./plugin-vue_export-helper.f99a0d42.js";import{a as c}from"./index.a482147f.js";var r,f;const g=(f=(r=window==null?void 0:window.Attendee)==null?void 0:r.cpUrl)!=null?f:"https://researchschool.org.uk/cp",$=p("trainings",{state:()=>({attendees:null,totalAttendees:null,attendeeInput:null,dataEngagement:null,attendeeFormErrors:!1,attendeeSuccess:!1,showForm:!1,loading:!1,loadingApi:!1,schools:null,followOnSupportOptions:null,order:"date"}),actions:{fetchOptions(n){const t=this;this.loading=!0,c({method:"get",url:`${g}/craft-attendees/trainings/fetch-support-options/${n}`}).then(function(d){var a,i;t.loading=!1,t.followOnSupportOptions=(a=d.data)==null?void 0:a.options,t.followOnSupportSelectedOptions=(i=d.data)==null?void 0:i.selectedOptions})},saveOption(n){const t=this;this.loading=!0,c({method:"post",url:`${g}/actions/craft-attendees/training/save-support-options`,data:n}).then(function(d){t.loading=!1})},async fetchSchools(n){var t;if(n){this.loadingApi=!0;const a=await c.create({baseURL:`https://api.v2.metaseed.io/schools/?mode=legacy&query=${n}`,timeout:3e3}).get("");a!=null&&a.data?(this.schools=(t=a.data)==null?void 0:t.suggestions,this.loadingApi=!1):this.loadingApi=!1}},deleteAttendees(n){const t=this;this.loading=!0,c({method:"post",url:`${g}/actions/craft-attendees/training/delete`,data:n}).then(function(d){t.loading=!1,n.attendees.forEach(a=>{t.attendees=t.attendees.filter(i=>i.id!=a)})})},submitAttendee(n){let t={};if(n instanceof FormData)for(var d of n.entries())t[d[0]]=d[1];else t=n;this.attendeeFormErrors=!1,this.loading=!0,this.attendeeSuccess=!1,this.attendeeInput=t;const a=this;c({method:"post",url:`${g}/actions/craft-attendees/training/save`,data:n}).then(function(i){var o;if(!i.data.success)a.attendeeFormErrors=i.data.errors,a.loading=!1,a.attendeeSuccess=!1;else{let e=a.attendees.filter(h=>{var s,l;return h.id==((l=(s=i==null?void 0:i.data)==null?void 0:s.attendee)==null?void 0:l.id)});const u=a.attendees.findIndex(h=>{var s,l;return h.id==((l=(s=i==null?void 0:i.data)==null?void 0:s.attendee)==null?void 0:l.id)});e.length>0?(e=e[0],e.name=t==null?void 0:t.name,e.orgName=t==null?void 0:t.orgName,e.orgUrn=parseInt(t==null?void 0:t.orgUrn),e.postCode=t==null?void 0:t.postCode,e.days=t==null?void 0:t.days,e.email=t==null?void 0:t.email,e.newsletter=t==null?void 0:t.newsletter,e.approved=t==null?void 0:t.approved,e.jobRole=t==null?void 0:t.jobRole,e.priority=t==null?void 0:t.priority,e.anonymous=t==null?void 0:t.anonymous,a.attendees[u]=e):a.attendees.unshift((o=i==null?void 0:i.data)==null?void 0:o.attendee),a.loading=!1,a.attendeeFormErrors=!1,a.attendeeSuccess=!0,a.attendeeInput=null}})},fetchAttendees(n,t,d,a,i=!1){const o=this;this.loading=!0,this.order=t,i&&(this.attendees=[]),c({method:"get",url:`${g}/craft-attendees/trainings/attendees/${n}/${t}/${d}/${a}`}).then(function(e){var u,h,s,l;o.loading=!1,o.totalAttendees=parseInt((h=(u=e==null?void 0:e.data)==null?void 0:u.meta)==null?void 0:h.total),o.attendees=a!==0?o.attendees.concat((s=e==null?void 0:e.data)==null?void 0:s.attendees):(l=e==null?void 0:e.data)==null?void 0:l.attendees})},fetchEngagementData(n){c({method:"get",url:`${g}/craft-attendees/trainings/engagement-data/${n}`}).then(function(t){var d;self.loading=!1,self.dataEngagement=(d=t==null?void 0:t.data)==null?void 0:d.engagement})},setShowFrom(n){this.attendeeFormErrors=!1,this.showForm=n},resetForm(){this.loading=!1,this.attendeeFormErrors=!1,this.attendeeInput=null},clearSchools(){this.schools=null}}});export{$ as u};
//# sourceMappingURL=trainings.868ee365.js.map
